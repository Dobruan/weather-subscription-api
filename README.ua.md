
# Weather Subscription API üå§

API-—Å–µ—Ä–≤—ñ—Å –¥–ª—è –ø—ñ–¥–ø–∏—Å–∫–∏ –Ω–∞ –ø—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥–∏ —É –≤–∏–±—Ä–∞–Ω–æ–º—É –º—ñ—Å—Ç—ñ –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø–æ email —Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—é —Ä–æ–∑—Å–∏–ª–∫–æ—é.

---

## üõ† –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ–π

- **NestJS** ‚Äî –≥–æ–ª–æ–≤–Ω–∏–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –ª–æ–≥—ñ–∫–∏
- **PostgreSQL** ‚Äî –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –ø—ñ–¥–ø–∏—Å–æ–∫
- **TypeORM** ‚Äî —Ä–æ–±–æ—Ç–∞ –∑ –ë–î + –º—ñ–≥—Ä–∞—Ü—ñ—ó
- **Docker + Docker Compose** ‚Äî –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫—É
- **Mailtrap** ‚Äî —Å–∏–º—É–ª—è—Ü—ñ—è email-–≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
- **Swagger (OpenAPI)** ‚Äî –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è API
- **CRON + @nestjs/schedule** ‚Äî –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–∞ —Ä–æ–∑—Å–∏–ª–∫–∞
- **Unit-—Ç–µ—Å—Ç–∏** ‚Äî –¥–ª—è —Å–µ—Ä–≤—ñ—Å–Ω–æ—ó –ª–æ–≥—ñ–∫–∏

---

## üì¶ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ –∑–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω—É–≤–∞—Ç–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π

```bash
git clone ...
cd weather-subscription-api
```

### 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è `.env`

```env
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_USER=postgres
DATABASE_PASSWORD=postgres
DATABASE_NAME=weather

WEATHER_API_KEY=your_weather_api_key
MAILTRAP_USER=your_mailtrap_user
MAILTRAP_PASS=your_mailtrap_pass
BASE_URL=http://localhost:3000
```

### 3. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

```bash
docker-compose up --build
```

–ë–î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç—å—Å—è, –∑–∞–ø—É—Å—Ç—è—Ç—å—Å—è –º—ñ–≥—Ä–∞—Ü—ñ—ó.

---

## üöÄ –û—Å–Ω–æ–≤–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ API

### üîπ –ü—ñ–¥–ø–∏—Å–∫–∞

- POST `/api/subscription` ‚Äî —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å–∫–∏
- –¢–æ–∫–µ–Ω –Ω–∞–¥—Å–∏–ª–∞—î—Ç—å—Å—è –ª–∏—Å—Ç–æ–º –Ω–∞ email
- GET `/api/subscription/confirm/:token` ‚Äî –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å–∫–∏

### üîπ –†–æ–∑—Å–∏–ª–∫–∞

- `CRON`-–∑–∞–¥–∞—á–∞ –ø—Ä–∞—Ü—é—î —â–æ–≥–æ–¥–∏–Ω–∏
- –ù–∞–¥—Å–∏–ª–∞—î –ª–∏—Å—Ç –ª–∏—à–µ —è–∫—â–æ:
  - `frequency: hourly` ‚Üí –º–∏–Ω—É–ª–æ ‚â• 60 —Ö–≤
  - `frequency: daily` ‚Üí –º–∏–Ω—É–ª–æ ‚â• 24 –≥–æ–¥
- –í –ª–∏—Å—Ç—ñ ‚Äî –∞–∫—Ç—É–∞–ª—å–Ω–∞ –ø–æ–≥–æ–¥–∞ –ø–æ –º—ñ—Å—Ç—É

---

## üß† –õ–æ–≥—ñ–∫–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó

1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ä–µ—î—Å—Ç—Ä—É—î –ø—ñ–¥–ø–∏—Å–∫—É (–º—ñ—Å—Ç–æ, email, —á–∞—Å—Ç–æ—Ç–∞)
2. –ì–µ–Ω–µ—Ä—É—î—Ç—å—Å—è —Ç–æ–∫–µ–Ω –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
3. –õ–∏—Å—Ç –∑ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ Mailtrap
4. –ü—ñ—Å–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è:
   - –∑–∞–ø–∏—Å –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è (`confirmed: true`)
   - –ø—ñ–¥–ø–∏—Å–∫–∞ –ø–æ—Ç—Ä–∞–ø–ª—è—î —É —á–µ—Ä–≥—É —Ä–æ–∑—Å–∏–ª–∫–∏
5. CRON-—Ä–æ–∑—Å–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—î `lastSentAt` —ñ frequency
6. –Ø–∫—â–æ –ø–æ—Ä–∞ ‚Äî –æ—Ç—Ä–∏–º—É—î –ø–æ–≥–æ–¥—É —á–µ—Ä–µ–∑ Weather API —ñ –Ω–∞–¥—Å–∏–ª–∞—î email

---

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

- `SubscriptionService` ‚Äî –ª–æ–≥—ñ–∫–∞ –ø—ñ–¥–ø–∏—Å–∫–∏, –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è, –≤—ñ–¥–ø–∏—Å–∫–∏
- `WeatherService` ‚Äî –º–æ–∫ –∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ API
- `TasksService` ‚Äî —Ä–æ–∑—Å–∏–ª–∫–∞ –∑ —á–∞—Å—Ç–æ—Ç–æ—é —Ç–∞ –æ–±—Ä–æ–±–∫–æ—é –ø–æ–º–∏–ª–æ–∫
- –ö–æ–º–∞–Ω–¥–∞:

```bash
npm run test
```

---

## üìö Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

> –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞:

```
http://localhost:3000/api/docs
```

---

## üóÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
src/
‚îú‚îÄ‚îÄ subscription/       # –ü—ñ–¥–ø–∏—Å–∫–∞, CRUD, –ª–æ–≥—ñ–∫–∞
‚îú‚îÄ‚îÄ weather/            # –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ–≥–æ–¥–∏
‚îú‚îÄ‚îÄ mail/               # –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –ª–∏—Å—Ç—ñ–≤
‚îú‚îÄ‚îÄ tasks/              # CRON-–∑–∞–¥–∞—á—ñ
‚îú‚îÄ‚îÄ app.module.ts       # –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –º–æ–¥—É–ª—ñ–≤
```

---

## üìù –î–æ–¥–∞—Ç–∫–æ–≤–æ

- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ `@nestjs/config` ‚Äî –≤—Å—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –≤ .env
- –õ–æ–≥—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –µ—Ç–∞–ø—ñ–≤ —Ä–æ–∑—Å–∏–ª–∫–∏
- –ö–∞—Å—Ç–æ–º–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ `TasksService` ‚Äî –≤–∏–≤–æ–¥–∏—Ç—å—Å—è –ø—Ä–∏—á–∏–Ω–∞, —á–æ–º—É –ª–∏—Å—Ç –Ω–µ –±—É–≤ –Ω–∞–¥—ñ—Å–ª–∞–Ω–∏–π

---

## ‚ùó –í—ñ–¥–æ–º—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è / TODO

- –í–∞–ª—ñ–¥–∞—Ü—ñ—è email/–º—ñ—Å—Ç–∞ –º–æ–∂–µ –±—É—Ç–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω–∞
- –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ª–∏—Å—Ç–∞ –Ω–∞ —Ä–µ–∞–ª—å–Ω—É –ø–æ—à—Ç—É –Ω–µ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ (Mailtrap)
- –í—ñ–¥—Å—É—Ç–Ω—è html-—Å—Ç–æ—Ä—ñ–Ω–∫–∞ –¥–ª—è –ø—ñ–¥–ø–∏—Å–∫–∏ (extra)

---
## –ú–æ–∂–ª–∏–≤—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è
 1. **–í–∏–±—ñ—Ä —á–∞—Å—É –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**
–î–æ–¥–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –æ–±–∏—Ä–∞—Ç–∏ –±–∞–∂–∞–Ω—É –≥–æ–¥–∏–Ω—É –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —â–æ–¥–µ–Ω–Ω–∏—Ö –æ–Ω–æ–≤–ª–µ–Ω—å (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –æ 08:00). –ù–∞—Ä–∞–∑—ñ —Ä–æ–∑—Å–∏–ª–∫–∞ –ø—Ä–∏–≤‚Äô—è–∑–∞–Ω–∞ –¥–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ä–æ–∑–∫–ª–∞–¥—É CRON. –î–ª—è —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ü—ñ—î—ó —Ñ—É–Ω–∫—Ü—ñ—ó –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–µ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è –∞–±–æ –¥–∏–Ω–∞–º—ñ—á–Ω—É —á–µ—Ä–≥—É –∑–∞–≤–¥–∞–Ω—å.
2. **–ü—ñ–¥–ø–∏—Å–∫–∞ –∑–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏**  
–î–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –ø—ñ–¥–ø–∏—Å—É–≤–∞—Ç–∏—Å—å, –≤–∫–∞–∑—É—é—á–∏ GPS-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ (—à–∏—Ä–æ—Ç–∞ —Ç–∞ –¥–æ–≤–≥–æ—Ç–∞), –∞ –Ω–µ –ª–∏—à–µ –Ω–∞–∑–≤—É –º—ñ—Å—Ç–∞. –¶–µ –ø—ñ–¥–≤–∏—â–∏—Ç—å —Ç–æ—á–Ω—ñ—Å—Ç—å —ñ –¥–æ–∑–≤–æ–ª–∏—Ç—å –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –º–µ–Ω—à –≤—ñ–¥–æ–º—ñ –∞–±–æ —Ç–æ—á–∫–æ–≤—ñ –ª–æ–∫–∞—Ü—ñ—ó.
3. **–ü—ñ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫—ñ–ª—å–∫–∞ –º—ñ—Å—Ç –¥–ª—è –æ–¥–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**  
–†–æ–∑—à–∏—Ä–∏—Ç–∏ –º–æ–¥–µ–ª—å –¥–∞–Ω–∏—Ö, —â–æ–± –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –æ–¥–Ω–æ–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É –ø—ñ–¥–ø–∏—Å—É–≤–∞—Ç–∏—Å—å –Ω–∞ –ø—Ä–æ–≥–Ω–æ–∑–∏ –ø–æ–≥–æ–¥–∏ –≤ –∫—ñ–ª—å–∫–æ—Ö –º—ñ—Å—Ç–∞—Ö. –î–ª—è —Ü—å–æ–≥–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏ –æ–∫—Ä–µ–º—É —Å—É—Ç–Ω—ñ—Å—Ç—å User —ñ –∑–≤'—è–∑–æ–∫ "–æ–¥–∏–Ω –¥–æ –±–∞–≥–∞—Ç—å–æ—Ö" –∑ –ø—ñ–¥–ø–∏—Å–∫–∞–º–∏.
4. **–î–≤–æ—Ñ–∞–∫—Ç–æ—Ä–Ω–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è (2FA)**  
–ó–∞–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ 2FA –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è —Ä—ñ–≤–Ω—è –±–µ–∑–ø–µ–∫–∏. –ü—ñ–¥ —á–∞—Å –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∞–±–æ –≤—Ö–æ–¥—É –≤ –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å (—è–∫—â–æ —Ç–∞–∫—ñ –±—É–¥–µ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ), –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î –≤–≤–æ–¥–∏—Ç–∏ –∫–æ–¥ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è, –Ω–∞–¥—ñ—Å–ª–∞–Ω–∏–π –Ω–∞ email.
---

## üë®‚Äçüíª –ê–≤—Ç–æ—Ä

–†–æ–∑—Ä–æ–±–ª–µ–Ω–æ —è–∫ —á–∞—Å—Ç–∏–Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è –¥–ª—è **GENESIS Software Engineering School 5.0**.
